<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Entry â€” PolicyWorth</title>
  <link rel="stylesheet" href="/css/styles.css" />
  <script type="module" src="/js/auth.js"></script>
  <script type="module">
    /* Auth guard: require login */
    import { auth } from '/js/auth.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        const next = encodeURIComponent(window.location.pathname);
        window.location.href = `/login.html?next=${next}`;
      }
    });
  </script>
  <style>
    /* Light form polish to match our Apple-ish theme */
    .form-grid { display:grid; grid-template-columns: repeat(6, minmax(0,1fr)); gap:14px; }
    .form-grid .span-2 { grid-column: span 2 / span 2; }
    .form-grid .span-3 { grid-column: span 3 / span 3; }
    .form-grid .span-6 { grid-column: 1 / -1; }
    label span { font-size:12px; color:#6b7280; display:block; margin-bottom:6px; }
    input, select { width:100%; height:40px; padding:8px 10px; border-radius:10px; border:1px solid var(--border); background:#fff; }
    input[type="number"] { text-align:right; }
    .actions { display:flex; gap:10px; align-items:center; }
    .table { width:100%; border-collapse:collapse; }
    .table th, .table td { padding:12px 10px; border-top:1px solid var(--border); }
    .table th { text-align:left; font-weight:600; color:#6b7280; }
    .table tr:hover td { background:#fafafa; }
    .muted { color:#6b7280; }
  </style>
</head>
<body>
  <noscript>
    <div class="container" style="padding:16px">
      <div class="card">JavaScript is required for Data Entry.</div>
    </div>
  </noscript>

  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="/"><span class="brand-mark">PW</span><span class="brand-name">PolicyWorth</span></a>
      <nav class="nav"><ul>
        <li><a class="link" href="/index.html">Home</a></li>
        <li><a class="link link--gated" aria-disabled="true" title="Login to access" href="/dashboard.html">Dashboard</a></li>
        <li><a class="link link--gated" aria-disabled="true" title="Login to access" href="/survey.html">Survey</a></li>
        <li><a class="link" href="/data-entry.html" aria-current="page">Data Entry</a></li>
        <li><a class="link link--gated" aria-disabled="true" title="Login to access" href="/reports.html">Reports</a></li>
        <li><a class="link link--gated" aria-disabled="true" title="Login to access" href="/settings.html">Settings</a></li>
      </ul></nav>
      <div class="auth"></div>
    </div>
  </header>

  <main class="container" style="padding:32px 20px 56px">
    <!-- Add tally card -->
    <section class="card" style="margin-bottom:20px">
      <div class="eyebrow">Add tally</div>
      <form id="tallyForm" class="form-grid" autocomplete="off">
        <label>
          <span>Date</span>
          <input id="date" name="date" type="date" required />
        </label>
        <label class="span-2">
          <span>State</span>
          <select id="state" name="state" required></select>
        </label>
        <label class="span-3">
          <span>County</span>
          <select id="county" name="county" required disabled>
            <option value="">Select a state first</option>
          </select>
        </label>
        <label class="span-3">
          <span>Service</span>
          <select id="service" name="service" required>
            <option value="case_mgmt">Case Management</option>
            <option value="hdm">Home-Delivered Meals</option>
            <option value="caregiver_respite">Caregiver/Respite</option>
            <option value="crisis_intervention">Crisis Intervention</option>
          </select>
        </label>
        <label>
          <span>Yes</span>
          <input id="yes" name="yes" type="number" min="0" step="1" value="0" required />
        </label>
        <label>
          <span>No</span>
          <input id="no" name="no" type="number" min="0" step="1" value="0" required />
        </label>
        <div class="actions span-6" style="margin-top:6px">
          <button class="btn btn--primary" type="submit">Save</button>
          <div id="msg" class="muted" aria-live="polite"></div>
        </div>
      </form>
    </section>

    <!-- Recent entries card -->
    <section class="card">
      <div class="eyebrow">Recent entries</div>
      <div class="muted" id="emptyState" style="display:none; margin:6px 0 10px">No entries yet.</div>
      <div class="table-wrap" style="overflow:auto">
        <table class="table" id="entriesTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>State</th>
              <th>County</th>
              <th>Service</th>
              <th>Yes</th>
              <th>No</th>
              <th>Added</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="muted" id="limitNote" style="margin-top:8px">Showing latest 50.</div>
    </section>
  </main>

  <!-- The data-entry.js handles:
       - loading /data/states-counties.json
       - remembering last state+county per user in localStorage
       - Firestore write & live table -->
  <script type="module" src="/js/data-entry.js"></script>
</body>
</html>
